<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="deductions_report_template">
            <t t-call="web.html_container">
                <div class="article basic_layout">
                    <div class="text-center">
                        <h3>
                            <t t-esc="docs.company_id.display_name"/>
                        </h3>
                        <h4>
                            DEDUCTIONS REPORT
                        </h4>
                        <h5>
                            Period: <t t-esc="data.get('report_start')"/> - <t t-esc="data.get('report_end')"/>
                        </h5>
                        <h5>
                            Generated By: <t t-esc="data.get('name')"/>
                            On: <t t-esc="date_time.get('date')"/>
                            At: <t t-esc="date_time.get('time')"/>
                        </h5>
                        <hr/>
                    </div>
                    <div class="full-width">
                        <table width="100%" class="text-center">
                            <tr>
                                <th>
                                    <span>ID</span>
                                </th>
                                <th>
                                    <span>Employee</span>
                                </th>
                                <th>
                                    <span>Date</span>
                                </th>
                                <th>
                                    <span>Description</span>
                                </th>
                                <th>
                                    <span>Comments</span>
                                </th>
                                <th>
                                    <span>Employee Contributions</span>
                                </th>
                                <th>
                                    <span>Employeer Contributions</span>
                                </th>
                                <th>
                                    <span>YTD Totals</span>
                                </th>
                            </tr>
                            <tbody>
                                <t t-set="default_value" t-value="0"/>
                                
                                <t t-set="outer_count" t-value="default_value"/>
                                <t t-set="outer_c_total" t-value="default_value"/>
                                <t t-set="outer_a_total" t-value="default_value"/>

                                <t t-set="totality" t-value="totals.get('totality')"/>
                                <t t-set="deduction_list" t-value="totality.get('deduction_amount_index')"/>

                                <t t-set="empty_value">&#32;</t>

                                <t t-set="deduction_type" t-value="default_value"/>
                                <t t-set="count" t-value="default_value"/>

                                <t t-set="c_total" t-value="default_value"/>

                                <t t-set="last_employee" t-value="default_value"/>
                                <t t-set="last_type" t-value="default_value"/>

                                <t t-set="current_employee" t-value="default_value"/>
                                <t t-set="current_type" t-value="default_value"/>

                                <t t-foreach="deduction_list" t-as="item">
                                    <tr>
                                            <t t-set="deduction_to_employee" t-value="totality.get('deduction_to_employee')"/>
                                                <tr t-if="deduction_to_employee[count] != deduction_type">
                                                    
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <t t-if="deduction_type != default_value">
                                                        <td t-attf-style="white-space:nowrap;"><span><b><t t-esc="deduction_to_employee[count-1]"/></b></span></td>
                                                        <td t-attf-style="white-space:nowrap;"><span><b><t t-esc="c_total"/></b></span></td>
                                                        <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    </t>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>
                                                    <td t-attf-style="white-space:nowrap;"><span></span></td>

                                                    <t t-set="deduction_type" t-value="deduction_to_employee[count]"/>
                                                    <t t-set="c_total" t-value="default_value"/>
                                                    <t t-set="outer_c_total" t-value="default_value"/>
                                                    
                                                </tr>  
                                                <td>
                                                    <t t-set="employee_id" t-value="empty_value" />
                                                    <t t-set="payslip" t-value="totality.get('payslip')"/>
                                                    <t t-if="payslip[count].employee_id.barcode == False" t-set="employee_id" t-value="payslip[count].employee_id.barcode"/>
                                                    <span><t t-esc="employee_id"/></span>
                                                </td>
                                                <td>
                                                    <t t-set="employee" t-value="totality.get('employee')"/>
                                                    <span><t t-esc="employee[count]"/></span>
                                                </td>
                                                <td>
                                                    <span><t t-esc="payslip[count].date_to"/></span>
                                                </td>
                                                <td>
                                                    <span><t t-esc="date_time.get('date')"/></span>
                                                </td>  
                                                <td t-attf-style="white-space:nowrap;"><span><t t-esc="deduction_to_employee[count]"/></span></td>
                                                <t t-set="amount" t-value="totality.get('deduction_amount_index')"/>
                                                <t t-set="c_total" t-value="c_total + amount[count]"/>
                                                <td t-attf-style="white-space:nowrap;"><span><t t-esc="amount[count]"/></span></td>
                                                <td t-attf-style="white-space:nowrap;"><span><t t-esc="empty_value"/></span></td>
                                                <t t-set="deductions_ytd" t-value="totality.get('deductions_ytd')"/>
                                                <td t-attf-style="white-space:nowrap;"><span><t t-esc="'{:,.2f}'.format(deductions_ytd[count])"/></span></td>

                                                <t t-set="outer_c_total" t-value="outer_c_total + amount[count]"/>
                                                <t t-set="outer_a_total" t-value="outer_a_total + amount[count]"/>
                                            
                                            <t t-set="count" t-value="count + 1"/>
                                            <t t-set="outer_count" t-value="count"/>                                       
                                    </tr>
                                </t>
                            </tbody>
                            <tr>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                    <t t-set="totality" t-value="totals.get('totality')"/>
                                    <t t-set="deduction_to_employee" t-value="totality.get('deduction_to_employee')"/>
                                <td t-attf-style="white-space:nowrap;"><span><b><t t-esc="deduction_to_employee[outer_count-1]"/></b></span></td>
                                <td t-attf-style="white-space:nowrap;"><span><b><t t-esc="outer_c_total"/></b></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                            </tr>
                            <tr>
                                <hr style="border-top: 0.5px solid black;"/>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span><b><t t-esc="docs.company_id.display_name"/></b></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                                <td t-attf-style="white-space:nowrap;"><span><b>Total : </b></span></td>
                                <td t-attf-style="white-space:nowrap;"><span><b><t t-esc="outer_a_total"/></b></span></td>
                                <td t-attf-style="white-space:nowrap;"><span></span></td>
                            </tr>
                        </table>
                        <hr style="border-top: 2px solid black;"/>
                        <span>
                            <b>
                                <t>Total Employees: </t>
                                <t t-set="totality" t-value="totals.get('totality')"/>
                                <t t-set="employee" t-value="totality.get('employee')"/>
                                <t t-esc="len(employee)"/>
                            </b>
                        </span>
                        <hr style="border-top: 4px solid black;"/>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>